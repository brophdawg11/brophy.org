<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="lang">
  <head data-n-head="">
    <title data-n-head="true">Matt Brophy's Personal Website</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="Matt Brophy's Personal Website"><meta data-n-head="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-n-head="true" name="apple-mobile-web-app-capable" content="yes"><meta data-n-head="true" name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta data-n-head="true" name="apple-mobile-web-app-title" content="brophy.org"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="author" name="author" content="Matt Brophy"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="black"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="brophy.org"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="brophy.org"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="Matt Brophy's Personal Website"><link data-n-head="true" rel="manifest" href="/manifest.json"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon/favicon.ico"><link data-n-head="true" rel="shortcut icon" type="image/x-icon" href="/favicon/favicon.ico"><link data-n-head="true" rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link data-n-head="true" rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="57x57" href="/favicon/apple-touch-icon-57x57.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="60x60" href="/favicon/apple-touch-icon-60x60.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="72x72" href="/favicon/apple-touch-icon-72x72.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="76x76" href="/favicon/apple-touch-icon-76x76.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="114x114" href="/favicon/apple-touch-icon-114x114.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="120x120" href="/favicon/apple-touch-icon-120x120.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="144x144" href="/favicon/apple-touch-icon-144x144.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="152x152" href="/favicon/apple-touch-icon-152x152.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="167x167" href="/favicon/apple-touch-icon-167x167.png"><link data-n-head="true" rel="apple-touch-icon" type="image/x-icon" sizes="180x180" href="/favicon/apple-touch-icon-180x180.png"><link data-n-head="true" rel="icon" type="image/png" sizes="192x192" href="/favicon/android-chrome-192x192.png"><link rel="preload" href="/_nuxt/runtime.22102a7afd9fdd49cb99.js" as="script"><link rel="preload" href="/_nuxt/async/commons.app.818c68e7fc8bb0f5bf2d.js" as="script"><link rel="preload" href="/_nuxt/async/app.4457040a617c756a85cc.js" as="script"><link rel="preload" href="/_nuxt/async/pages/post/_slug.d851e136b06223941c64.js" as="script"><style data-vue-ssr-id="8b5acbe2:0 452097a8:0 17cfdfa9:0 132df51d:0 95822e54:0 4effc658:0 745b4ac0:0 27df31d4:0 58764380:0">@font-face{font-family:icon-font;font-display:fallback;src:url(/_nuxt/fonts/02c7d2c.woff) format("woff");font-weight:400;font-style:normal}[class*=" fa-"]:before,[class^=fa-]:before{font-family:icon-font;font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-home:before{content:"\e800"}.fa-chat:before{content:"\e801"}.fa-left-big:before{content:"\e802"}.fa-right-big:before{content:"\e803"}.fa-twitter:before{content:"\f099"}.fa-facebook:before{content:"\f09a"}.fa-github-circled:before{content:"\f09b"}.fa-gplus:before{content:"\f0d5"}.fa-angle-double-right:before{content:"\f101"}.fa-rss-squared:before{content:"\f143"}.fa-doc-text-inv:before{content:"\f15c"}.fa-instagram:before{content:"\f16d"}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}@font-face{font-family:system;font-style:normal;font-weight:300;src:local(".SFNSText-Light"),local(".HelveticaNeueDeskInterface-Light"),local(".LucidaGrandeUI"),local("Ubuntu Light"),local("Segoe UI Light"),local("Roboto-Light"),local("DroidSans"),local("Tahoma")}body{font-family:system}*{box-sizing:border-box}body{font-size:100%;color:#181818}body,h1{font-family:"PT Serif",serif}h1{font-size:1.5rem;font-weight:700;margin:.67rem 0}@media (min-width:768px){h1{font-size:2rem}}h2{font-family:"PT Serif",serif;font-size:1.25rem;font-weight:700;margin:.75rem 0}@media (min-width:768px){h2{font-size:1.6rem}}h3{font-family:"PT Serif",serif;font-size:1rem;font-weight:700;margin:.83rem 0}@media (min-width:768px){h3{font-size:1.4rem}}h4{font-family:"PT Serif",serif;font-size:.83rem;font-weight:700;margin:1rem 0}@media (min-width:768px){h4{font-size:1.2rem}}pre{font-family:monospace;overflow-y:hidden;overflow-x:auto}a{color:#aa5d00;text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}.nuxt-progress{background-color:#fff;height:5px}@media (min-width:1024px){.nuxt-progress{left:384px;background-color:#aa5d00}}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.page-aside{background-position:50% 50%;background-size:cover;height:150px;background-image:url(/_nuxt/img/f09bc75.jpg)}@media screen and (min-width:768px){.page-aside{background-image:url(/_nuxt/img/d5754ab.jpg)}}@media screen and (min-width:1024px){.page-aside{position:fixed;top:0;left:0;bottom:0;width:384px;height:100%;background-image:url(/_nuxt/img/7cb7e48.jpg)}}.page-content-wrapper{display:flex;flex-direction:column;position:relative;padding:2em}@media screen and (min-width:1024px){.page-content-wrapper{padding:2em 0;margin-left:calc(384px + 2em);width:calc(100% - 384px - 4em);min-height:100vh}}.page-content{width:100%;max-width:768px;margin:auto;padding-bottom:2em;flex:1;display:flex;flex-direction:column;justify-content:center}.page-header{position:absolute;top:-75px;left:0;right:0;padding-bottom:2em;text-align:center}@media screen and (min-width:1024px){.page-header{position:relative;top:0}}.page-footer{padding-top:2em;text-align:center}.page-footer-nav{text-align:center;font-size:.75em}.s-footer-links.page-links__ul{padding-bottom:2em}.s-footer-links .page-link__li{margin:1.5em .75em}@media screen and (min-width:500px){.s-footer-links .page-link__li{margin:1em}}.page-links__ul{text-align:center;color:#aa5d00}.page-link__li{display:inline-block;margin:1em}@media screen and (min-width:1024px){.page-link__li{position:relative}}.page-link__a{background-color:#fafafa;border:2px solid #aa5d00;border-radius:50%;transition:all .2s;padding:1.25em .7em 1em;text-decoration:none;font-family:system,sans-serif}.page-link__a .fa{font-size:1.5em}.page-link__a:active,.page-link__a:hover,.page-link__a:link,.page-link__a:visited{color:inherit;text-decoration:none}.page-link__a:focus,.page-link__a:hover{background-color:#aa5d00;color:#fafafa}@media screen and (min-width:1024px){.page-link__a:focus .page-link__p,.page-link__a:hover .page-link__p{opacity:1}}.page-link__p{display:none}@media screen and (min-width:1024px){.page-link__p{display:block;color:#aa5d00;opacity:0;position:absolute;bottom:0;width:150%;margin-bottom:-3em;margin-left:-25%;text-align:center;left:0;right:0;transition:opacity .2s;font-size:.8em}}.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}.c-post__title{margin-bottom:10px}.c-post__meta{font-size:.9em;font-style:italic;margin-bottom:2em}.c-post__date{font-style:italics}.c-post__content{font-size:1.15em;line-height:1.75em}.c-post__content p{font-size:.9em;line-height:1.5em;padding-bottom:2em}@media screen and (min-width:768px){.c-post__content p{font-size:1em}}.c-post__content p img{display:block;margin:0 auto;max-width:100%}.c-post__content li{font-size:.9em;line-height:1.5em}.c-post__content strong{font-weight:700}.c-post__content em{font-style:italic}.c-post__content code{padding:0 3px;font-family:monospace;background-color:#eee}.c-post__content pre{padding-bottom:2em;margin:0}@media screen and (min-width:768px){.c-post__content pre{margin-left:2em;margin-right:2em}}.c-post__content pre code{padding:1em;font-size:.9em;line-height:1.25em}.c-post__content blockquote{padding:1em;background-color:#eee;margin:0 0 2em;font-style:italic}@media screen and (min-width:768px){.c-post__content blockquote{margin-left:2em;margin-right:2em}}.c-post__content blockquote ol,.c-post__content blockquote ul{margin-left:40px;padding-bottom:2em}.c-post__content blockquote p:last-child{padding-bottom:0}.c-post__content ol,.c-post__content ul{margin-left:40px;margin-bottom:2em}.c-post__share{text-align:right;margin-bottom:2em}.c-post__share-lead-in{padding-bottom:.66667em}.c-post__share-medium .fa{padding:5px;border-radius:50%;transition:color .2s,background-color .2s}.c-post__share-medium .fa:focus,.c-post__share-medium .fa:hover{color:#fff;background-color:#aa5d00}.c-meta__line1{padding-bottom:.5rem}.c-meta__divider{padding:0 10px}.c-post-nav{display:flex}.c-post-nav__link{flex-grow:1}.c-post-nav__link--previous{padding-right:10px;text-align:left}.c-post-nav__link--next{padding-left:10px;text-align:right}.page-footer-line{line-height:1.5em;padding:.25em}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><aside class="page-aside"><div class="page-aside-img-loader"></div></aside> <section class="page-content-wrapper"><header class="page-header"><nav><ul class="page-links__ul s-header-links"><li class="page-link__li"><a href="/" title="Home" class="page-link__a nuxt-link-active"><span class="fa fa-home"></span><span class="page-link__p">Home</span></a></li><li class="page-link__li"><a href="/posts/" title="Blog" class="page-link__a"><span class="fa fa-chat"></span><span class="page-link__p">Blog</span></a></li><li class="page-link__li"><a href="/resume/" title="Resume" class="page-link__a"><span class="fa fa-doc-text-inv"></span><span class="page-link__p">Resume</span></a></li></ul></nav></header> <div class="page-content"><article><header><h1 class="c-post__title">
            Building a Blog with Metalsmith
        </h1> <div class="c-post__meta"><div><p class="c-meta__line1"><span title="Feb 15, 2017" class="c-meta__date">
            a couple of years ago
        </span> <span class="c-meta__divider c-meta__divider--first">|</span> <span class="c-meta__readtime">8 min read</span></p> <p class="c-meta__line2"><span class="c-meta__tags">
            Tags:
            <a href="/tag/ssg/" title="ssg">ssg</a>, <a href="/tag/javascript/" title="javascript">javascript</a>, <a href="/tag/metalsmith/" title="metalsmith">metalsmith</a>, <a href="/tag/blog/" title="blog">blog</a><!----></span></p></div></div></header> <section class="c-post__content"><p>Ever want to set up your own blog?  Stuck on which Static Site Generator to use?  Know Javascript?  Or don't?  After trying out multiple NodeJS based SSG's, and looking into multiple non-NodeJS based ones, I settled on Metalsmith for my own blog.  Here's my beginner's guide to setting up a new blog from scratch.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>You have <a href="https://nodejs.org/" title="Node.js">NodeJS</a> installed.  And are hopefully at least a <em>little</em> familiar with it.</li>
</ul>
<h2 id="setup">Setup</h2>
<p>Start with a brand new empty directory, set it up for a Node project, and install <a href="http://metalsmith.io" title="Metalsmith">Metalsmith</a>:</p>
<pre><code class="hljs bash">> mkdir blog
> <span class="hljs-built_in">cd</span> blog
> npm init
<span class="hljs-comment"># Answer questions</span>
> npm install --save metalsmith</code></pre>
<p>Create your bare-bones Metalsmith build file, <code>build.js</code>:</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> Metalsmith  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith'</span>);

Metalsmith(__dirname)
    .source(<span class="hljs-string">'./contents'</span>)       <span class="hljs-comment">// read files from here</span>
    .destination(<span class="hljs-string">'./output'</span>)    <span class="hljs-comment">// write files to here</span>
    .build(<span class="hljs-function"><span class="hljs-params">err</span> =></span> {             <span class="hljs-comment">// build!</span>
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;     <span class="hljs-comment">// handle errors</span>
    });</code></pre>
<p>Yep, that's it.  That's a fully-functioning Metalsmith static site.  It's not going to do anything but copy your stuff from <code>contents/</code> into <code>output/</code>, but it works.  Give it a shot - make your first content file and run the build:</p>
<pre><code class="hljs bash">> mkdir contents
> <span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;h1>Hello World&lt;/h1>"</span> > contents/index.html
> node build.js
> cat output/index.html
&lt;h1>Hello World&lt;/h1></code></pre>
<p>Look at that, there's our file, processed through the Metalsmith pipeline.</p>
<p>The pipeline is an important concept to grasp when it comes to working with Metalsmith.  You tell it where to find your input files via <code>.source()</code> and where to write the output files via <code>.destination()</code>, and then you will begin inserting a bunch of plugins as ordered steps along the pipeline.  When all your plugins are registered, you call <code>.build()</code> to start the processing.  It will then process <em>all</em> files from your <code>source</code> directory through the plugin pipeline, transforming them at each step of the way, and finally write out the final files in your <code>destination</code> directory.</p>
<p>Let's take a look at what the pipeline looks like by writing and adding our first plugin.  Add the following between the <code>destination</code> and <code>build</code> steps:</p>
<pre><code class="hljs javascript">.use(<span class="hljs-function">(<span class="hljs-params">files, metalsmith, done</span>) =></span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'files'</span>, files);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'metalsmith'</span>, metalsmith);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done'</span>, done);
    setImmediate(done);
})</code></pre>
<p>This is the format of a plugin and it's going to show us exactly what the pipeline looks like.  A plugin is called with <code>.use(Function)</code>, and in most plugins, you'll see that you call the plugin which returns the function you'll pass to <code>.use()</code>.  Each step of the pipeline receives three arguments - the <code>files</code> object, the <code>metalsmith</code> object, and a <code>done</code> callback.</p>
<p><strong>The <code>files</code> object:</strong></p>
<pre><code class="hljs json">{
    'index.html': {
        contents: &lt;Buffer>,
        mode: '0644',
        stats: {
            dev: 16777220,
            mode: 33188,
            ...
        }
    }
}</code></pre>
<p>The files object is just a key-value store with an entry for each file in your <code>source</code> directory.  It stores some useful information about the file in <code>mode</code> and <code>stats</code>, and it stores the entire content of the file as a <code>Buffer</code> in <code>contents</code>.  You can easily convert the<code>Buffer</code> to a string using <code>files['index.html'].contents.toString()</code>.</p>
<p><strong>The <code>metalsmith</code> object</strong></p>
<p>...is not super important for now.  It's got lots of global metadata about the actual build you're running.  Maybe we'll come back to it, but in building out <a href="https://www.brophy.org" title="brophy.org">this blog</a>, I don't think I ever actually touched it.</p>
<p><strong>The <code>done()</code> callback</strong></p>
<p>This is to tell Metalsmith when you're done.  For whatever reason, all of their examples show it being called with <code>setImmediate</code> during synchronous plugins, so I followed suit.  Don't ask me why that matters.</p>
<h2 id="lets-make-it-bloggy">Let's make it "Bloggy"</h2>
<p>Ok, so using Metalsmith to copy/paste files around seems pretty stupid.  Let's start adding some of the <a href="http://www.metalsmith.io/#the-community-plugins" title="Metalsmith Plugins">Community Plugins</a> to make this thing useful.</p>
<h3 id="markdown">Markdown</h3>
<p>Let's stop writing HTML directly and use markdown.  First, install the plugin:</p>
<pre><code class="hljs bash">> npm install --save metalsmith-markdown</code></pre>
<p>Then, add the plugin as a step in the pipeline, right before our final debugging plugin we set up above.  Please excuse the inline <code>require</code> - that's only for readability in this post.</p>
<pre><code class="hljs javascript">.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-markdown'</span>)())</code></pre>
<p>And then rename and alter your existing <code>index.html</code> file to an <code>index.md</code> file, and adjust it's contents to be markdown:</p>
<pre><code class="hljs bash">> mv contents/index.html contents/index.md
> <span class="hljs-built_in">echo</span> <span class="hljs-string">"# Hello World"</span> > contents/index.md
> node build.js
> cat output/index.html
&lt;h1>Hello World&lt;/h1></code></pre>
<p>Simple enough?  The <code>metalsmith-markdown</code> plugin essentially does the following with the <code>files</code> object:</p>
<ol>
<li>For each <code>*.md</code> key, indicating a markdown file in your <code>source</code> directory</li>
<li>Convert the contents to HTML by running it through a markdown parser</li>
<li>Write out the new <code>file</code> as <code>*.html</code></li>
<li>Delete the old <code>*.md</code> key entry</li>
</ol>
<p>It might seem odd that it's deleting the old one, but that's again an important aspect of the metalsmith pipeline.  The <code>.build()</code> step at the very end essentially just writes the <code>files</code> object to disk.  For every key in <code>files</code>, a file matching that path is created in your <code>destination</code> directory, and the contents written to it.  If we didn't create the new <code>index.html</code> key in <code>files</code>, we wouldn't get an <code>output/index.html</code> file, and if we didn't delete the <code>index.md</code> key, we'd also get an <code>output/index.md</code> file written out.</p>
<h3 id="templating">Templating</h3>
<p>Now that we're converting markdown to HTML, let's start wrapping our contents in a common header and footer using nunjucks templates.  First, install the <code>metalsmith-layouts</code> plugin and the <code>nunjucks</code> package, and create a directory to store our templates:</p>
<pre><code class="hljs bash">> npm install --save metalsmith-layouts nunjucks
> mkdir templates</code></pre>
<p>Then add two templates we'll use for scaffolding the HTML page:</p>
<pre><code class="hljs html">// templates/layout.nunjucks
<span class="hljs-meta">&lt;!doctype html></span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>></span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>></span>
    {% block head %}
    {% endblock %}
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>></span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>></span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>></span>
        {% block header %}
            Welcome to My Blog!
        {% endblock %}
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>></span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>></span>
        {% block content %}{% endblock %}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>></span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>></span>
        {% block footer %}
            Built with <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://metalsmith.io/"</span>></span>Metalsmith<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>></span>
        {% endblock %}
    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>></span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>></span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>></span></code></pre>
<pre><code class="hljs html">// temmplates/post.nunjucks
{% extends "templates/layout.nunjucks" %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"post"</span>></span>
        {{ contents | safe }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>></span>
{% endblock %}</code></pre>
<p>Basically, <code>layout.nunjucks</code> will be the base layout for every single page on out site, providing extendable blocks where content can be inserted.  Then <code>post.nunjucks</code> extends the layout tempate, and inserts the file contents inside the <code>body</code> block.</p>
<p>Now, add a pipeline step that will process your files against these templates</p>
<pre><code class="hljs javascript">.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-layouts'</span>)({
    <span class="hljs-attr">engine</span>: <span class="hljs-string">'nunjucks'</span>,        <span class="hljs-comment">// Which engine to use</span>
    directory: <span class="hljs-string">'templates'</span>,    <span class="hljs-comment">// Where are the templates stored</span>
    <span class="hljs-keyword">default</span>: <span class="hljs-string">'post.nunjucks'</span>   <span class="hljs-comment">// Default template to use</span>
}))</code></pre>
<p>Now, when you run the pipeline, you should see a full-structured     index.html` file written out, using the proper above layout.</p>
<h2 id="page-titles-and-specific-layouts">Page titles and specific layouts</h2>
<p>Let's look at how we might both title a post as well as choose a specific layout to use.  Metalsmith supports <a href="https://middlemanapp.com/basics/frontmatter/" title="Frontmatter">YAML Frontmatter</a> by default (which can be turned off, but I don't see a good reason why), so you can specify metadata at the beginning of your source files.  So, insert the following at the beginning of <code>index.md</code>:</p>
<pre><code class="hljs markdown">---
title: My first Blog Post
<span class="hljs-section">layout: post.nunjucks
---</span>
</code></pre>
<p>Those entries will become key/value pairs on the file object in the pipeline, and also exposed to your templates.  So now we can enhance our <code>post.nunjucks</code> file to include the title:</p>
<pre><code class="hljs html">{% extends "templates/layout.nunjucks" %}

{% block header %}
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>></span>{{ title }} <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>></span>
{% endblock %}

{% block content %}
    ...
{% endblock %}</code></pre>
<p>And the <code>metalsmith-layouts</code> plugin already looks for a <code>layout</code> property on every source file, and uses that prior to the default.</p>
<h2 id="next-steps">Next Steps</h2>
<p>So what's next?  We've got markdown files with frontmatter metadata building into a nunjucks-driven extensible layout structure.  What do we need to move this into a full-on blog?  Here's the list of plugins I'm using to host <a href="https://www.brophy.org" title="brophy.org">brophy.org</a>, and feel free to check out the source for this site over in <a href="https://www.github.com/brophdawg11/brophy.org" title="brophy.org on GitHub">GitHub</a> if you want to see any examples:</p>
<ul>
<li><code>metalsmith-collections</code> to organize all of your posts into sorted collections</li>
<li><code>metalsmith-pagination</code> to group your collections into paginated lists</li>
<li><code>metalsmith-metallic</code> for syntax highlighting in code blocks</li>
<li><code>metalsmith-page-titles</code> to generate HTML <code>&lt;title></code> content</li>
<li><code>metalsmith-assets</code> to copy over static assets</li>
<li><code>metalsmith-favicons</code> to copy over and setup your site icons</li>
<li><code>metalsmith-drafts</code> to support draft posts that don't get published</li>
<li><code>metalsmith-permalinks</code> to generate permalinks without the <code>.html</code></li>
<li><code>metalsmith-excerpts</code> to grab the first paragraph of a post for an overview display</li>
<li><code>metalsmith-tags</code> to allow tagging of posts and listing posts by tag`</li>
<li><code>metalsmith-sass</code> for SCSS compilation</li>
<li><code>metalsmith-icons</code> for easy inclusion of custom icon fonts from font-awesome</li>
<li><code>metalsmith-feed</code> to generate an RSS feed</li>
</ul>
<p>Good luck!</p>
</section> <footer><div class="c-post__share"><p class="c-post__share-lead-in">
                Enjoy this post?
            </p> <a href="https://twitter.com/share?text=Building a Blog with Metalsmith&amp;amp;url=https://www.brophy.org/post/building-a-blog-with-metalsmith" class="c-post__share-medium">
                Share on Twitter
            </a>

            or

            <a href="https://twitter.com/search?q=https://www.brophy.org/post/building-a-blog-with-metalsmith" target="_blank" rel="noopener noreferrer" class="c-post__share-medium">
                Discuss on Twitter
            </a></div> <div class="c-post-nav"><!----> <!----></div></footer></article></div> <footer class="page-footer"><nav class="page-footer-nav"><ul class="page-links__ul s-footer-links"><li class="page-link__li"><a href="https://www.github.com/brophdawg11" title="GitHub" target="_blank" rel="noopener" class="page-link__a"><span class="fa fa-github-circled"></span><span class="page-link__p">GitHub</span></a></li><li class="page-link__li"><a href="https://www.instagram.com/brophdawg11" title="Instagram" target="_blank" rel="noopener" class="page-link__a"><span class="fa fa-instagram"></span><span class="page-link__p">Instagram</span></a></li><li class="page-link__li"><a href="https://www.twitter.com/brophdawg11" title="Twitter" target="_blank" rel="noopener" class="page-link__a"><span class="fa fa-twitter"></span><span class="page-link__p">Twitter</span></a></li></ul></nav> <div><p class="page-footer-line">
        built with
        <a href="https://vuejs.org/" title="Vue" target="_blank" rel="noopener">
            vue
        </a>
        and
        <a href="https://nuxtjs.org/" title="Nuxt" target="_blank" rel="noopener">
            nuxt
        </a></p> <p class="page-footer-line">
        stored/hosted in
        <a href="https://www.github.com/brophdawg11/brophy.org" title="GitHub" target="_blank" rel="noopener">
            github
        </a>
        using
        <a href="https://pages.github.com/" title="Github Pages" target="_blank" rel="noopener">
            github pages
        </a></p> <p class="page-footer-line">
        side images from
        <a href="https://www.gratisography.com/" title="Gratisography" target="_blank" rel="noopener">
            gratisography
        </a></p> <p class="page-footer-line">
        icons from
        <a href="https://fontawesome.com/" title="Font-Awesome" target="_blank" rel="noopener">
            font-awesome
        </a>
        via
        <a href="http://fontello.com/" title="Fontello" target="_blank" rel="noopener">
            fontello
        </a></p> <p class="page-footer-line">
        Â© Copyright 2019 Matt Brophy
    </p></div></footer></section></div></div></div><script>window.__NUXT__=function(e,t){return{layout:"default",data:[[e,e]],error:null,state:{url:"https://www.brophy.org",title:t,description:"Matt Brophy's Website",rss:{title:"Matt Brophy's Blog"},pageSize:6,post:{title:"Building a Blog with Metalsmith",author:t,postDate:"2017-02-15 19:00",tags:"ssg,javascript,metalsmith,blog",__content:'<p>Ever want to set up your own blog?  Stuck on which Static Site Generator to use?  Know Javascript?  Or don&#39;t?  After trying out multiple NodeJS based SSG&#39;s, and looking into multiple non-NodeJS based ones, I settled on Metalsmith for my own blog.  Here&#39;s my beginner&#39;s guide to setting up a new blog from scratch.</p>\n<h2 id="prerequisites">Prerequisites</h2>\n<ul>\n<li>You have <a href="https://nodejs.org/" title="Node.js">NodeJS</a> installed.  And are hopefully at least a <em>little</em> familiar with it.</li>\n</ul>\n<h2 id="setup">Setup</h2>\n<p>Start with a brand new empty directory, set it up for a Node project, and install <a href="http://metalsmith.io" title="Metalsmith">Metalsmith</a>:</p>\n<pre><code class="hljs bash">&gt; mkdir blog\n&gt; <span class="hljs-built_in">cd</span> blog\n&gt; npm init\n<span class="hljs-comment"># Answer questions</span>\n&gt; npm install --save metalsmith</code></pre>\n<p>Create your bare-bones Metalsmith build file, <code>build.js</code>:</p>\n<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> Metalsmith  = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'metalsmith\'</span>);\n\nMetalsmith(__dirname)\n    .source(<span class="hljs-string">\'./contents\'</span>)       <span class="hljs-comment">// read files from here</span>\n    .destination(<span class="hljs-string">\'./output\'</span>)    <span class="hljs-comment">// write files to here</span>\n    .build(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {             <span class="hljs-comment">// build!</span>\n        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;     <span class="hljs-comment">// handle errors</span>\n    });</code></pre>\n<p>Yep, that&#39;s it.  That&#39;s a fully-functioning Metalsmith static site.  It&#39;s not going to do anything but copy your stuff from <code>contents/</code> into <code>output/</code>, but it works.  Give it a shot - make your first content file and run the build:</p>\n<pre><code class="hljs bash">&gt; mkdir contents\n&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;h1&gt;Hello World&lt;/h1&gt;"</span> &gt; contents/index.html\n&gt; node build.js\n&gt; cat output/index.html\n&lt;h1&gt;Hello World&lt;/h1&gt;</code></pre>\n<p>Look at that, there&#39;s our file, processed through the Metalsmith pipeline.</p>\n<p>The pipeline is an important concept to grasp when it comes to working with Metalsmith.  You tell it where to find your input files via <code>.source()</code> and where to write the output files via <code>.destination()</code>, and then you will begin inserting a bunch of plugins as ordered steps along the pipeline.  When all your plugins are registered, you call <code>.build()</code> to start the processing.  It will then process <em>all</em> files from your <code>source</code> directory through the plugin pipeline, transforming them at each step of the way, and finally write out the final files in your <code>destination</code> directory.</p>\n<p>Let&#39;s take a look at what the pipeline looks like by writing and adding our first plugin.  Add the following between the <code>destination</code> and <code>build</code> steps:</p>\n<pre><code class="hljs javascript">.use(<span class="hljs-function">(<span class="hljs-params">files, metalsmith, done</span>) =&gt;</span> {\n    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">\'files\'</span>, files);\n    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">\'metalsmith\'</span>, metalsmith);\n    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">\'done\'</span>, done);\n    setImmediate(done);\n})</code></pre>\n<p>This is the format of a plugin and it&#39;s going to show us exactly what the pipeline looks like.  A plugin is called with <code>.use(Function)</code>, and in most plugins, you&#39;ll see that you call the plugin which returns the function you&#39;ll pass to <code>.use()</code>.  Each step of the pipeline receives three arguments - the <code>files</code> object, the <code>metalsmith</code> object, and a <code>done</code> callback.</p>\n<p><strong>The <code>files</code> object:</strong></p>\n<pre><code class="hljs json">{\n    \'index.html\': {\n        contents: &lt;Buffer&gt;,\n        mode: \'0644\',\n        stats: {\n            dev: 16777220,\n            mode: 33188,\n            ...\n        }\n    }\n}</code></pre>\n<p>The files object is just a key-value store with an entry for each file in your <code>source</code> directory.  It stores some useful information about the file in <code>mode</code> and <code>stats</code>, and it stores the entire content of the file as a <code>Buffer</code> in <code>contents</code>.  You can easily convert the<code>Buffer</code> to a string using <code>files[&#39;index.html&#39;].contents.toString()</code>.</p>\n<p><strong>The <code>metalsmith</code> object</strong></p>\n<p>...is not super important for now.  It&#39;s got lots of global metadata about the actual build you&#39;re running.  Maybe we&#39;ll come back to it, but in building out <a href="https://www.brophy.org" title="brophy.org">this blog</a>, I don&#39;t think I ever actually touched it.</p>\n<p><strong>The <code>done()</code> callback</strong></p>\n<p>This is to tell Metalsmith when you&#39;re done.  For whatever reason, all of their examples show it being called with <code>setImmediate</code> during synchronous plugins, so I followed suit.  Don&#39;t ask me why that matters.</p>\n<h2 id="lets-make-it-bloggy">Let&#39;s make it &quot;Bloggy&quot;</h2>\n<p>Ok, so using Metalsmith to copy/paste files around seems pretty stupid.  Let&#39;s start adding some of the <a href="http://www.metalsmith.io/#the-community-plugins" title="Metalsmith Plugins">Community Plugins</a> to make this thing useful.</p>\n<h3 id="markdown">Markdown</h3>\n<p>Let&#39;s stop writing HTML directly and use markdown.  First, install the plugin:</p>\n<pre><code class="hljs bash">&gt; npm install --save metalsmith-markdown</code></pre>\n<p>Then, add the plugin as a step in the pipeline, right before our final debugging plugin we set up above.  Please excuse the inline <code>require</code> - that&#39;s only for readability in this post.</p>\n<pre><code class="hljs javascript">.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">\'metalsmith-markdown\'</span>)())</code></pre>\n<p>And then rename and alter your existing <code>index.html</code> file to an <code>index.md</code> file, and adjust it&#39;s contents to be markdown:</p>\n<pre><code class="hljs bash">&gt; mv contents/index.html contents/index.md\n&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">"# Hello World"</span> &gt; contents/index.md\n&gt; node build.js\n&gt; cat output/index.html\n&lt;h1&gt;Hello World&lt;/h1&gt;</code></pre>\n<p>Simple enough?  The <code>metalsmith-markdown</code> plugin essentially does the following with the <code>files</code> object:</p>\n<ol>\n<li>For each <code>*.md</code> key, indicating a markdown file in your <code>source</code> directory</li>\n<li>Convert the contents to HTML by running it through a markdown parser</li>\n<li>Write out the new <code>file</code> as <code>*.html</code></li>\n<li>Delete the old <code>*.md</code> key entry</li>\n</ol>\n<p>It might seem odd that it&#39;s deleting the old one, but that&#39;s again an important aspect of the metalsmith pipeline.  The <code>.build()</code> step at the very end essentially just writes the <code>files</code> object to disk.  For every key in <code>files</code>, a file matching that path is created in your <code>destination</code> directory, and the contents written to it.  If we didn&#39;t create the new <code>index.html</code> key in <code>files</code>, we wouldn&#39;t get an <code>output/index.html</code> file, and if we didn&#39;t delete the <code>index.md</code> key, we&#39;d also get an <code>output/index.md</code> file written out.</p>\n<h3 id="templating">Templating</h3>\n<p>Now that we&#39;re converting markdown to HTML, let&#39;s start wrapping our contents in a common header and footer using nunjucks templates.  First, install the <code>metalsmith-layouts</code> plugin and the <code>nunjucks</code> package, and create a directory to store our templates:</p>\n<pre><code class="hljs bash">&gt; npm install --save metalsmith-layouts nunjucks\n&gt; mkdir templates</code></pre>\n<p>Then add two templates we&#39;ll use for scaffolding the HTML page:</p>\n<pre><code class="hljs html">// templates/layout.nunjucks\n<span class="hljs-meta">&lt;!doctype html&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>\n    {% block head %}\n    {% endblock %}\n<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>\n        {% block header %}\n            Welcome to My Blog!\n        {% endblock %}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n        {% block content %}{% endblock %}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>\n        {% block footer %}\n            Built with <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://metalsmith.io/"</span>&gt;</span>Metalsmith<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>\n        {% endblock %}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>\n<pre><code class="hljs html">// temmplates/post.nunjucks\n{% extends "templates/layout.nunjucks" %}\n\n{% block content %}\n    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"post"</span>&gt;</span>\n        {{ contents | safe }}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n{% endblock %}</code></pre>\n<p>Basically, <code>layout.nunjucks</code> will be the base layout for every single page on out site, providing extendable blocks where content can be inserted.  Then <code>post.nunjucks</code> extends the layout tempate, and inserts the file contents inside the <code>body</code> block.</p>\n<p>Now, add a pipeline step that will process your files against these templates</p>\n<pre><code class="hljs javascript">.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">\'metalsmith-layouts\'</span>)({\n    <span class="hljs-attr">engine</span>: <span class="hljs-string">\'nunjucks\'</span>,        <span class="hljs-comment">// Which engine to use</span>\n    directory: <span class="hljs-string">\'templates\'</span>,    <span class="hljs-comment">// Where are the templates stored</span>\n    <span class="hljs-keyword">default</span>: <span class="hljs-string">\'post.nunjucks\'</span>   <span class="hljs-comment">// Default template to use</span>\n}))</code></pre>\n<p>Now, when you run the pipeline, you should see a full-structured     index.html` file written out, using the proper above layout.</p>\n<h2 id="page-titles-and-specific-layouts">Page titles and specific layouts</h2>\n<p>Let&#39;s look at how we might both title a post as well as choose a specific layout to use.  Metalsmith supports <a href="https://middlemanapp.com/basics/frontmatter/" title="Frontmatter">YAML Frontmatter</a> by default (which can be turned off, but I don&#39;t see a good reason why), so you can specify metadata at the beginning of your source files.  So, insert the following at the beginning of <code>index.md</code>:</p>\n<pre><code class="hljs markdown">---\ntitle: My first Blog Post\n<span class="hljs-section">layout: post.nunjucks\n---</span>\n</code></pre>\n<p>Those entries will become key/value pairs on the file object in the pipeline, and also exposed to your templates.  So now we can enhance our <code>post.nunjucks</code> file to include the title:</p>\n<pre><code class="hljs html">{% extends "templates/layout.nunjucks" %}\n\n{% block header %}\n    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ title }} <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>\n{% endblock %}\n\n{% block content %}\n    ...\n{% endblock %}</code></pre>\n<p>And the <code>metalsmith-layouts</code> plugin already looks for a <code>layout</code> property on every source file, and uses that prior to the default.</p>\n<h2 id="next-steps">Next Steps</h2>\n<p>So what&#39;s next?  We&#39;ve got markdown files with frontmatter metadata building into a nunjucks-driven extensible layout structure.  What do we need to move this into a full-on blog?  Here&#39;s the list of plugins I&#39;m using to host <a href="https://www.brophy.org" title="brophy.org">brophy.org</a>, and feel free to check out the source for this site over in <a href="https://www.github.com/brophdawg11/brophy.org" title="brophy.org on GitHub">GitHub</a> if you want to see any examples:</p>\n<ul>\n<li><code>metalsmith-collections</code> to organize all of your posts into sorted collections</li>\n<li><code>metalsmith-pagination</code> to group your collections into paginated lists</li>\n<li><code>metalsmith-metallic</code> for syntax highlighting in code blocks</li>\n<li><code>metalsmith-page-titles</code> to generate HTML <code>&lt;title&gt;</code> content</li>\n<li><code>metalsmith-assets</code> to copy over static assets</li>\n<li><code>metalsmith-favicons</code> to copy over and setup your site icons</li>\n<li><code>metalsmith-drafts</code> to support draft posts that don&#39;t get published</li>\n<li><code>metalsmith-permalinks</code> to generate permalinks without the <code>.html</code></li>\n<li><code>metalsmith-excerpts</code> to grab the first paragraph of a post for an overview display</li>\n<li><code>metalsmith-tags</code> to allow tagging of posts and listing posts by tag`</li>\n<li><code>metalsmith-sass</code> for SCSS compilation</li>\n<li><code>metalsmith-icons</code> for easy inclusion of custom icon fonts from font-awesome</li>\n<li><code>metalsmith-feed</code> to generate an RSS feed</li>\n</ul>\n<p>Good luck!</p>\n',excerpt:"Ever want to set up your own blog?  Stuck on which Static Site Generator to use?  Know Javascript?  Or don&apos;t?  After trying out multiple NodeJS based SSG&apos;s, and looking into multiple non-NodeJS based ones, I settled on Metalsmith for my own blog.  Here&apos;s my beginner&apos;s guide to setting up a new blog from scratch.",permalink:"/post/building-a-blog-with-metalsmith",readingTime:{text:"8 min read",minutes:7.5,time:45e4,words:1500},slug:"building-a-blog-with-metalsmith"},posts:[]},serverRendered:!0}}(void 0,"Matt Brophy")</script><script src="/_nuxt/runtime.22102a7afd9fdd49cb99.js" defer></script><script src="/_nuxt/async/pages/post/_slug.d851e136b06223941c64.js" defer></script><script src="/_nuxt/async/commons.app.818c68e7fc8bb0f5bf2d.js" defer></script><script src="/_nuxt/async/app.4457040a617c756a85cc.js" defer></script>
  </body>
</html>
